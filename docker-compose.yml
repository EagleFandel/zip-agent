version: "3"

services:
  zip-agent:
    build:
      context: "https://github.com/EagleFandel/zip-agent.git"
      dockerfile: Dockerfile
    container_name: zip-agent
    restart: unless-stopped
    environment:
      - GITEA_URL=http://gitea:3000
      - GITEA_TOKEN=${GITEA_TOKEN}
      - GITEA_OWNER=${GITEA_OWNER:-nomo-admin}
      - GITEA_PUBLIC_URL=${GITEA_PUBLIC_URL}
      - ZIP_AGENT_API_KEY=${ZIP_AGENT_API_KEY}
      - PORT=8080
    depends_on:
      - gitea
    expose:
      - "8080"

  gitea:
    image: gitea/gitea:latest
    container_name: gitea
    environment:
      - USER_UID=1000
      - USER_GID=1000
      - GITEA__database__DB_TYPE=sqlite3
      - GITEA__server__ROOT_URL=${GITEA_PUBLIC_URL}/
      - GITEA__server__HTTP_PORT=3000
      - GITEA__server__DISABLE_SSH=true
      - GITEA__service__DISABLE_REGISTRATION=true
      - GITEA__service__REQUIRE_SIGNIN_VIEW=false
    restart: unless-stopped
    volumes:
      - gitea-data:/data
    expose:
      - "3000"
    labels:
      - traefik.http.services.gitea.loadbalancer.server.port=3000

volumes:
  gitea-data:
